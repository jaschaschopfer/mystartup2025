<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ECTS-Zähler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f5f5f5;
    }
    .counter-box {
      background: white;
      padding: 20px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    #counter {
      font-size: 3em;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="counter-box">
    <h2>ECTS-Zähler (werktags 9:15–16:45)</h2>
    <div id="counter">0.000</div>
    <p>Diese ECTS hast du schon in der Tasche!</p>
  </div>

  <script>
    // --- Parameter ---
    const startDate = new Date("2025-09-01T09:15:00");
    const endValue = 4.0;
    const days = 5;
    const minutesPerDay = 450; // 7,5 Stunden = 450 Minuten
    const totalMinutes = days * minutesPerDay; // 2250 Minuten
    const stepPerMinute = endValue / totalMinutes; // ca. 0.00178 pro Minute

    // Prüfen, ob ein Datum innerhalb der Handelszeiten liegt
    function isWithinTradingHours(date) {
      const day = date.getDay(); // 0=Sonntag, 6=Samstag
      if (day === 0 || day === 6) return false;

      const hours = date.getHours();
      const minutes = date.getMinutes();

      const afterStart = (hours > 9) || (hours === 9 && minutes >= 15);
      const beforeEnd = (hours < 16) || (hours === 16 && minutes <= 45);

      return afterStart && beforeEnd;
    }

    // Vergangene Minuten innerhalb Handelszeiten berechnen
    function getMinutesElapsed() {
      const now = new Date();
      if (now < startDate) return 0;

      let elapsed = 0;
      let current = new Date(startDate);

      while (current < now) {
        if (isWithinTradingHours(current)) {
          elapsed++;
        }
        current.setMinutes(current.getMinutes() + 1);
        if (elapsed >= totalMinutes) break; // Abbruch wenn Ziel erreicht
      }

      return elapsed;
    }

    // Zähler aktualisieren
    function updateCounter() {
      const minutes = getMinutesElapsed();
      const value = Math.min(minutes * stepPerMinute, endValue);
      document.getElementById("counter").textContent = value.toFixed(3);
    }

    // Initiale Anzeige
    updateCounter();

    // --- Automatischer Refresh zum Beginn der nächsten Minute ---
    const now = new Date();
    const msUntilNextMinute = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
    setTimeout(() => {
      location.reload();
    }, msUntilNextMinute);
  </script>
</body>
</html>
